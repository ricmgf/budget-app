/* ============================================================
   Budget App — CSS v3.0 — Option C Premium Dark
   ============================================================ */
:root {
  --bg-primary: #f7f8fa; --bg-secondary: #ffffff; --bg-tertiary: #eef0f4;
  --bg-hover: #e8eaf0; --bg-active: #dce0e8;
  --text-primary: #1a1d23; --text-secondary: #5a6070; --text-tertiary: #8890a0; --text-inverse: #ffffff;
  --border-light: #e2e5eb; --border-medium: #ccd0d8;
  --accent: #2563eb; --accent-hover: #1d4ed8; --accent-light: #dbeafe; --accent-subtle: #eff6ff;
  --success: #16a34a; --success-light: #dcfce7; --warning: #d97706; --warning-light: #fef3c7;
  --danger: #dc2626; --danger-light: #fef2f2;
  --positive: #10b981; --negative: #ef4444;
  --font-sans: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
  --text-xs: 11px; --text-sm: 13px; --text-base: 14px; --text-lg: 16px;
  --sp-1: 4px; --sp-2: 8px; --sp-3: 12px; --sp-4: 16px; --sp-5: 20px; --sp-6: 24px; --sp-8: 32px;
  --radius-sm: 6px; --radius-md: 10px; --radius-lg: 16px;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05); --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: var(--font-sans); background: var(--bg-primary); color: var(--text-primary); font-size: var(--text-base); -webkit-font-smoothing: antialiased; }

/* === SIDEBAR === */
.app-sidebar { transition: width 0.3s ease; overflow: hidden; overflow-y: auto; }
.sidebar-toggle-btn { display:flex; align-items:center; justify-content:center; width:100%; height:32px; margin-bottom:8px; background:none; border:none; cursor:pointer; font-size:20px; color:var(--text-secondary); border-radius:6px; transition:all .2s; flex-shrink:0; }
.sidebar-toggle-btn:hover { background:var(--bg-tertiary); color:var(--text-primary); }
.sidebar-brand { display:flex; align-items:center; gap:12px; margin-bottom:24px; padding:0 12px; }
.app-sidebar.collapsed { width:60px !important; }
.app-sidebar.collapsed .sidebar-label, .app-sidebar.collapsed .nav-label, .app-sidebar.collapsed .nav-section-label { display:none; }
.app-sidebar.collapsed .sidebar-brand { justify-content:center; padding:0; }
.app-sidebar.collapsed .nav-item { justify-content:center; padding:10px 8px; }
.app-sidebar.collapsed .nav-icon { margin-right:0; }
.nav-icon { margin-right:10px; font-size:16px; flex-shrink:0; }
.nav-label { white-space:nowrap; }
.nav-section-label { margin:20px 12px 8px; font-size:11px; font-weight:700; color:#94a3b8; text-transform:uppercase; letter-spacing:.05em; }

/* === SHARED === */
.card { background:var(--bg-secondary); border-radius:var(--radius-lg); padding:var(--sp-5); border:1px solid var(--border-light); box-shadow:var(--shadow-sm); }
.btn { display:inline-flex; align-items:center; justify-content:center; padding:var(--sp-2) var(--sp-4); border-radius:var(--radius-sm); font-weight:600; font-size:var(--text-sm); cursor:pointer; transition:all .2s; border:1px solid transparent; gap:var(--sp-2); }
.btn-primary { background:var(--accent); color:var(--text-inverse); }
.btn-primary:hover { background:var(--accent-hover); }
.btn-secondary { background:var(--bg-tertiary); color:var(--text-secondary); }
.btn-ghost { background:transparent; color:var(--text-secondary); }
.badge { display:inline-flex; align-items:center; padding:2px 8px; border-radius:4px; font-size:var(--text-xs); font-weight:700; text-transform:uppercase; }
.badge-danger { background:var(--danger-light); color:var(--danger); }
.data-table { width:100%; border-collapse:collapse; font-size:var(--text-sm); }
.data-table th { background:var(--bg-tertiary); padding:var(--sp-2) var(--sp-3); text-align:left; font-weight:700; color:var(--text-secondary); border-bottom:1px solid var(--border-medium); }
.data-table td { padding:var(--sp-2) var(--sp-3); border-bottom:1px solid var(--border-light); }
.input { width:100%; padding:var(--sp-2) var(--sp-3); border-radius:var(--radius-sm); border:1px solid var(--border-medium); background:var(--bg-secondary); font-family:inherit; font-size:var(--text-sm); outline:none; }
.input:focus { border-color:var(--accent); }
.flex { display:flex; } .flex-between { display:flex; justify-content:space-between; align-items:center; }
.gap-2 { gap:8px; } .gap-3 { gap:12px; } .mb-4 { margin-bottom:16px; } .mb-6 { margin-bottom:24px; }
.text-right { text-align:right; } .text-muted { color:var(--text-tertiary); } .text-sm { font-size:var(--text-sm); }

/* === TAGS/MULTISELECT === */
.tag-card { display:inline-block; background:var(--bg-tertiary); color:var(--text-secondary); padding:4px 12px; border-radius:20px; font-size:12px; font-weight:500; margin-right:4px; border:1px solid var(--border-light); }
.custom-multiselect { position:relative; }
.ms-display { width:100%; padding:8px 12px; border-radius:6px; border:1px solid var(--border-light); background:var(--bg-secondary); cursor:pointer; font-size:13px; color:var(--text-secondary); min-height:38px; display:flex; align-items:center; }
.ms-options { display:none; position:absolute; top:100%; left:0; right:0; background:var(--bg-secondary); border:1px solid var(--border-light); border-radius:8px; box-shadow:var(--shadow-md); z-index:100; margin-top:4px; padding:8px 0; }
.ms-options.active { display:block; }
.ms-option { display:flex; align-items:center; gap:8px; padding:8px 12px; cursor:pointer; font-size:13px; }
.ms-option:hover { background:var(--bg-tertiary); }

/* === SETTINGS TABS === */
.settings-tabs { display:flex; gap:32px; border-bottom:1px solid var(--border-light); margin-bottom:32px; }
.settings-tab { padding:12px 0; font-weight:700; font-size:14px; color:var(--text-secondary); border-bottom:2px solid transparent; cursor:pointer; background:none; border-top:none; border-left:none; border-right:none; font-family:inherit; letter-spacing:.02em; transition:color .2s; }
.settings-tab:hover { color:var(--text-primary); }
.settings-tab.active { color:var(--accent); border-bottom-color:var(--accent); }

/* === IMPORT === */
.import-dropzone { border:2px dashed var(--border-medium); border-radius:var(--radius-lg); padding:48px 24px; text-align:center; background:var(--bg-secondary); cursor:pointer; transition:all .2s; }
.import-dropzone:hover,.import-dropzone.dragover { border-color:var(--accent); background:var(--accent-subtle); }
.import-preview-table { width:100%; border-collapse:collapse; font-size:13px; margin-top:16px; }
.import-preview-table th { background:var(--bg-tertiary); padding:8px 12px; text-align:left; font-weight:700; font-size:11px; text-transform:uppercase; }
.import-preview-table td { padding:8px 12px; border-bottom:1px solid var(--border-light); }

/* ════════════════════════════════════════════════════════
   BUDGET GRID — Option C: Premium Dark + Yellow Column
   ════════════════════════════════════════════════════════ */

/* Bank Tabs — consistent with Settings */
.budget-bank-tabs { display:flex; gap:0; border-bottom:2px solid var(--border-light); margin-bottom:16px; align-items:center; }
.budget-bank-tab { padding:10px 20px; font-weight:600; font-size:13px; color:var(--text-secondary); border:none; background:none; cursor:pointer; font-family:inherit; white-space:nowrap; border-bottom:2px solid transparent; margin-bottom:-2px; transition:all .2s; }
.budget-bank-tab:hover { color:var(--text-primary); background:#f8fafc; }
.budget-bank-tab.active { color:var(--accent); border-bottom-color:var(--accent); }
.uncat-badge { margin-left:auto; padding:6px 14px; font-size:12px; font-weight:600; color:var(--danger); background:var(--danger-light); border-radius:20px; cursor:pointer; }
.uncat-badge:hover { background:#fecaca; }

/* Grid Container */
.budget-grid-wrap { overflow-x:auto; overflow-y:visible; border:1px solid var(--border-light); border-radius:10px; background:white; }
.budget-grid { width:max-content; min-width:100%; border-collapse:collapse; font-size:12px; }

/* ── HEADER: Dark premium ── */
.budget-grid thead th {
  background:#0f172a; color:#e2e8f0; padding:9px 6px; text-align:center;
  font-size:10px; text-transform:uppercase; letter-spacing:.06em; font-weight:700;
  border-right:1px solid #1e293b; position:sticky; top:0; z-index:2;
}
.budget-grid thead th.th-left {
  text-align:left; min-width:190px; position:sticky; left:0; z-index:4; background:#0f172a;
}
.budget-grid thead th.th-month { min-width:135px; }
.budget-grid thead .sub-hdr th {
  background:#1e293b; color:#64748b; padding:4px 6px; font-size:9px; font-weight:600;
  border-bottom:2px solid #334155; border-right:1px solid #334155;
}
.budget-grid thead .sub-hdr th.th-left { background:#1e293b; }

/* Current month header = gold */
.budget-grid thead th.cur-hdr { background:#facc15 !important; color:#1a1d23 !important; font-weight:800 !important; }
.budget-grid thead .sub-hdr th.cur-hdr { background:#fbbf24 !important; color:#78350f !important; }

/* Closed month header = grey */
.budget-grid thead th.closed-hdr { background:#475569 !important; color:#94a3b8 !important; }
.budget-grid thead .sub-hdr th.closed-hdr { background:#334155 !important; color:#64748b !important; }

/* Unclosed past month header = amber warning */
.budget-grid thead th.unclosed-hdr { background:#92400e !important; color:#fbbf24 !important; }

/* ── DATA ROWS ── */
.budget-grid tbody td {
  padding:6px 8px; text-align:right; border-bottom:1px solid #f1f3f5;
  font-variant-numeric:tabular-nums; font-size:12px; color:var(--text-primary);
}
.budget-grid tbody td.frozen {
  text-align:left; font-weight:500; color:#334155; position:sticky; left:0;
  background:white; z-index:1; border-right:1px solid var(--border-light);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:220px; padding-left:12px;
}
.budget-grid tbody tr:hover td { background:#f7f8fa; }
.budget-grid tbody tr:hover td.frozen { background:#f7f8fa; }

/* Current month column = yellow */
.budget-grid tbody td.cur { background:#fef9c3 !important; }
.budget-grid tbody tr:hover td.cur { background:#fef08a !important; }

/* Closed month column = grey */
.budget-grid tbody td.closed { background:#f1f5f9 !important; color:#64748b !important; }
.budget-grid tbody tr:hover td.closed { background:#e2e8f0 !important; }

/* Uncategorized */
.budget-grid tbody tr.uncat td.frozen { border-left:3px solid var(--danger); }

/* ── SECTION HEADERS with inline actions ── */
.bg-section-hdr td {
  background:#f1f5f9; font-weight:700; font-size:11px; text-transform:uppercase;
  letter-spacing:.04em; padding:10px 12px; border-bottom:2px solid var(--accent);
  color:#0f172a;
}
.bg-section-hdr td.frozen { border-left:4px solid var(--accent); position:sticky; left:0; z-index:2; background:#f1f5f9; display:flex; justify-content:space-between; align-items:center; gap:8px; }
.bg-section-hdr td.sec-cell { background:#f1f5f9; border-bottom:2px solid var(--accent); }
.sec-name { font-weight:700; }
.sec-actions { font-size:11px; font-weight:500; text-transform:none; letter-spacing:0; }
.sec-actions a { color:#94a3b8; cursor:pointer; text-decoration:none; transition:color .15s; }
.sec-actions a:hover { color:var(--accent); }
.formula-sign { display:inline-block; width:14px; text-align:center; color:#94a3b8; font-weight:700; font-size:11px; margin-right:2px; }
.auto-tag { font-size:10px; margin-right:3px; opacity:0.6; }

/* Tarjeta collapsible rows */
.tarjeta-parent td.frozen { font-weight:600; }
.tarjeta-child td { background:#fafbfc !important; }
.tarjeta-child td.frozen { font-size:11px; color:var(--text-secondary); }
.collapse-toggle {
  display:inline-block; min-width:20px; font-size:14px; font-weight:600;
  color:var(--accent); cursor:pointer; padding:2px 6px 2px 0; text-align:center;
}
.collapse-toggle:hover { color:var(--accent-hover, #1d4ed8); }

/* Note indicator — Excel-style triangle */
.note-indicator {
  display:inline-block; font-size:7px; color:var(--accent); margin-left:3px;
  cursor:help; line-height:1; vertical-align:top; opacity:0.6;
}
.note-indicator:hover { opacity:1; }
.note-indicator.grey { color:#94a3b8; cursor:pointer; }

/* Global tooltip (positioned by JS) */
.bg-tooltip {
  position:fixed; z-index:9999; background:#1e293b; color:#e2e8f0;
  padding:8px 12px; border-radius:8px; font-size:11px; font-weight:400;
  max-width:300px; min-width:100px; white-space:pre-wrap; line-height:1.4;
  box-shadow:0 4px 12px rgba(0,0,0,.3); pointer-events:none; display:none;
}

/* ── Breakdown Modal ── */
.bd-modal-overlay { justify-content:center !important; align-items:center; }
.bd-modal {
  background:white; border-radius:16px; padding:24px;
  min-width:360px; max-width:600px; width:auto;
  box-shadow:0 20px 60px rgba(0,0,0,.2);
  max-height:80vh; display:flex; flex-direction:column;
}
.bd-modal-header {
  display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;
}
.bd-modal-header h3 { margin:0; font-size:15px; font-weight:700; }
.bd-modal-close {
  background:none; border:none; font-size:18px; cursor:pointer;
  color:var(--text-secondary); padding:4px 8px;
}
.bd-modal-close:hover { color:var(--text-primary); }
.bd-modal-body { overflow-y:auto; flex:1; }
.bd-modal-table { width:100%; border-collapse:collapse; }
.bd-modal-table thead tr { background:#f8fafc; }
.bd-modal-table th {
  padding:8px 12px; text-align:left; font-size:11px; font-weight:600;
  color:#94a3b8; text-transform:uppercase; letter-spacing:0.5px; white-space:nowrap;
}
.bd-modal-table th.bd-amount { text-align:right; }
.bd-modal-table td { padding:8px 12px; border-bottom:1px solid #f1f3f5; font-size:12px; }
.bd-modal-table td.bd-date { white-space:nowrap; color:#64748b; }
.bd-modal-table td.bd-concept { max-width:300px; overflow:hidden; text-overflow:ellipsis; word-break:break-word; }
.bd-modal-table td.bd-amount { text-align:right; font-variant-numeric:tabular-nums; white-space:nowrap; }
.bd-modal-footer {
  border-top:2px solid #0f172a; margin-top:8px; padding-top:12px;
  display:flex; justify-content:space-between; align-items:center;
}
.bd-modal-footer span:first-child { font-weight:700; font-size:13px; color:#64748b; }
.bd-modal-total { font-weight:800; font-size:15px; font-variant-numeric:tabular-nums; }

/* ── TOTALS — Clean Lines (no background) ── */
.bg-total td { font-weight:700; background:white !important; border-top:1px solid #cbd5e1; border-bottom:1px solid #cbd5e1; font-size:12px; }
.bg-total td.frozen { background:white !important; position:sticky; left:0; z-index:2; border-right:1px solid var(--border-light); }
.bg-total td.cur { background:#fef9c3 !important; }

/* ── SUMMARY — Option B Subtle Band ── */
.bg-summ td { font-weight:600; font-size:12px; background:#eff6ff !important; color:#1e40af; border-bottom:1px solid #dbeafe; }
.bg-summ td.frozen { background:#eff6ff !important; position:sticky; left:0; z-index:2; border-right:1px solid #dbeafe; }
.bg-summ.row-total td { background:#dbeafe !important; font-weight:800; color:#1e3a8a; }
.bg-summ.row-total td.frozen { background:#dbeafe !important; }
.bg-summ.row-income td { color:#1e40af; }
.bg-summ.row-cashflow td { font-weight:700; }
.bg-summ.row-meta td { background:#f0f4ff !important; color:#475569; font-weight:500; }
.bg-summ.row-meta td.frozen { background:#f0f4ff !important; }

/* ── ENVÍO NECESARIO — premium dark band ── */
.bg-envio td { background:#0f172a !important; color:#e2e8f0 !important; font-weight:700; font-size:13px; letter-spacing:.02em; }
.bg-envio td.frozen { background:#0f172a !important; color:#fbbf24 !important; position:sticky; left:0; z-index:2; }
.bg-envio td.cur { background:#1e293b !important; color:#fbbf24 !important; font-weight:800; }

/* ── Sticky thead ── */
.budget-grid-wrap { position:relative; max-height:calc(100vh - 160px); overflow:auto; }
.budget-grid thead { position:sticky; top:0; z-index:5; }

/* Value colors */
.val-neg { color:var(--danger) !important; } .val-pos { color:var(--success) !important; }

/* ── EDITABLE CELLS ── */
.budget-grid td.editable { cursor:pointer; }
.budget-grid td.editable:hover { outline:1px solid var(--accent); outline-offset:-1px; }
.budget-grid td.editing { padding:0 !important; }
.budget-grid td.editing input {
  width:100%; height:100%; padding:6px 8px; border:2px solid var(--accent); border-radius:0;
  font-size:12px; font-family:inherit; text-align:right; font-variant-numeric:tabular-nums; outline:none;
}

/* ── DRAWER ── */
.budget-drawer-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.3); z-index:1000; display:flex; justify-content:flex-end; }
.budget-drawer { width:380px; height:100%; background:white; box-shadow:-4px 0 20px rgba(0,0,0,.1); padding:24px; overflow-y:auto; }
.budget-drawer h3 { font-size:18px; font-weight:700; margin-bottom:20px; }
.budget-drawer label { display:block; font-size:11px; font-weight:700; text-transform:uppercase; color:var(--text-secondary); margin-bottom:6px; margin-top:16px; }
.budget-drawer input,.budget-drawer select { width:100%; padding:10px; border-radius:8px; border:1px solid var(--border-light); font-size:14px; font-family:inherit; }
.budget-drawer input:focus,.budget-drawer select:focus { border-color:var(--accent); outline:none; }
.drawer-actions { display:flex; gap:12px; margin-top:24px; }
.drawer-actions button { flex:1; padding:12px; border-radius:8px; border:none; font-weight:700; font-size:14px; cursor:pointer; font-family:inherit; }

/* Drawer: Group editor section */
.dw-group-section { margin-top:20px; border-top:1px solid var(--border-light); padding-top:16px; }
.dw-group-header { display:flex; justify-content:space-between; align-items:center; cursor:pointer; padding:8px 0; font-size:13px; font-weight:600; color:var(--text-secondary); }
.dw-group-header:hover { color:var(--accent); }
.dw-group-chevron { font-size:10px; transition:transform .2s; }
.dw-grp-empty { font-size:11px; color:var(--text-tertiary); padding:8px 0; }
.dw-grp-group { border:1px solid var(--border-light); border-radius:8px; padding:10px; margin-bottom:10px; }
.dw-grp-group-hdr { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.dw-grp-group-hdr strong { font-size:13px; color:var(--accent); }
.dw-grp-count { font-size:10px; color:var(--text-tertiary); }
.dw-grp-pattern { display:flex; align-items:center; gap:6px; padding:4px 8px; font-size:11px; background:var(--bg-tertiary); border-radius:4px; margin-bottom:3px; }
.dw-grp-pattern-text { flex:1; font-family:'SF Mono',monospace; font-size:11px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.dw-grp-pattern-bank { font-size:9px; color:var(--text-tertiary); }
.dw-grp-del { background:none; border:none; color:var(--text-tertiary); cursor:pointer; font-size:13px; padding:0 2px; line-height:1; }
.dw-grp-del:hover { color:var(--danger); }
.dw-grp-add { display:flex; gap:4px; margin-top:4px; }
.dw-grp-add-input { flex:1; padding:4px 8px; border:1px dashed var(--border-light); border-radius:4px; font-size:11px; font-family:inherit; }
.dw-grp-add-input:focus { border-color:var(--accent); outline:none; border-style:solid; }
.dw-grp-add-btn { background:var(--accent); color:white; border:none; border-radius:4px; width:26px; cursor:pointer; font-size:14px; font-weight:700; }
.dw-grp-add-btn:hover { opacity:.85; }
.dw-grp-new-section { margin-top:8px; }
.dw-grp-new-toggle { font-size:12px; color:var(--accent); font-weight:600; cursor:pointer; padding:6px 0; }
.dw-grp-new-toggle:hover { text-decoration:underline; }
.hidden { display:none !important; }
.btn-save { background:var(--accent); color:white; }
.btn-cancel { background:var(--bg-tertiary); color:var(--text-secondary); }
.btn-delete { background:var(--danger-light); color:var(--danger); margin-top:12px; width:100%; padding:10px; border:none; border-radius:8px; cursor:pointer; font-weight:600; font-size:13px; font-family:inherit; }
